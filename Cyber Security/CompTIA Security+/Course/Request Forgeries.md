### **Request Forgeries (Cross-Site Request Forgery - CSRF)**

**Request forgery**, often referred to as **Cross-Site Request Forgery** (**CSRF** or **XSRF**), is a type of attack that tricks a victim into submitting a request to a web application that they are authenticated on, without their knowledge or consent. This attack exploits the trust that a web application has in the user's browser and can lead to unintended actions being performed on behalf of the user, such as changing account details, making financial transactions, or altering user settings.

---

### **How CSRF (Request Forgery) Attacks Work**

1. **User Authentication:**
   - The victim is logged into a website or web application (such as an online banking service or social media platform), typically with a session cookie or an authentication token stored in their browser.
   
2. **Crafting the Malicious Request:**
   - The attacker creates a malicious website or email that contains hidden or disguised requests targeting a web application the victim is already authenticated on.
   - The attacker often embeds the malicious request within a form submission, URL, or even an image or iframe.

3. **User Visits the Malicious Site:**
   - The victim unknowingly visits the malicious website, usually by clicking on a link or interacting with an email, advertisement, or other form of communication.
   
4. **Request Execution Without User Consent:**
   - When the victim visits the attacker's site, the malicious request is automatically triggered in the background using the victim's credentials (session cookies or authentication tokens). Since the victim is already authenticated with the target site, the request is executed as if it were a legitimate action from the victim.
   
5. **Execution of Unintended Actions:**
   - The victim’s browser sends the forged request (such as changing their password, transferring money, or posting a message) to the targeted web application, and because the web app trusts the user's session, the action is processed without any further validation.

---

### **Common Examples of CSRF Attacks**

1. **Bank Account Transfers:**
   - Imagine a victim is logged into their online banking account. The attacker crafts a URL that, when visited by the victim, submits a request to transfer money from the victim’s bank account to the attacker’s account. If the web application doesn’t verify the source of the request (i.e., by checking for a CSRF token), the transfer might go through without the victim's knowledge.
   
2. **Changing Account Settings:**
   - An attacker could craft a malicious request that changes the victim’s email address, password, or security settings on a web application, such as social media accounts. Since the victim is already logged in, the request would go through without additional verification.
   
3. **Posting Content on Social Media:**
   - A victim who is logged into a social media account might be tricked into visiting an attacker’s site that automatically posts a message, link, or status update on their account. This could be used to spread spam, phishing links, or malicious content.

---

### **Consequences of CSRF Attacks**

1. **Unauthorized Transactions:**
   - CSRF can lead to unauthorized money transfers, purchases, or other financial transactions, potentially resulting in financial losses for users and organizations.

2. **Account Compromise:**
   - If an attacker is able to change the victim’s password or email address via CSRF, the attacker could gain control of the victim's account and perform further malicious actions, such as stealing personal information or accessing private content.

3. **Reputation Damage:**
   - CSRF attacks on social media accounts can be used to post malicious content or spam. If these attacks are carried out at a large scale, they can damage the reputation of the victim, their brand, or the attacked service.

4. **Spread of Malware:**
   - If attackers post malicious links or content on a victim’s behalf, it can spread malware or phishing attempts, potentially compromising more users and further propagating the attack.

---

### **Mitigation Techniques for CSRF Attacks**

1. **CSRF Tokens:**
   - The most common defense against CSRF attacks is to use **CSRF tokens**. A CSRF token is a random, unique string that is generated by the server and included in each request that requires action (such as form submissions or transactions). This token is sent with the request, and the server verifies that the token matches the one stored for the user’s session before processing the request. If the tokens do not match or are missing, the request is rejected.
   - **Example:** When submitting a form for a password change, the server sends a CSRF token as a hidden field, and the client must send it back with the form. The server will then check that the submitted token matches the one associated with the user session.

2. **SameSite Cookies:**
   - The **SameSite** attribute on cookies helps prevent the browser from sending cookies in cross-origin requests. This means that cookies (such as session cookies) will only be sent in requests that originate from the same domain as the one that set the cookie, reducing the risk of CSRF.
   - **SameSite=Strict** ensures that cookies are sent only with requests from the same site.
   - **SameSite=Lax** allows cookies to be sent with some cross-origin requests, such as navigations.
   
3. **Check Referrer Header:**
   - The **Referer** header is sent by the browser with HTTP requests, indicating the origin of the request. Web applications can check the `Referer` header to ensure that the request is coming from a trusted source (the same domain).
   - While not foolproof, checking the `Referer` header can provide additional protection against CSRF attacks.

4. **Custom HTTP Headers:**
   - By requiring specific custom headers (such as `X-Requested-With` or `X-CSRF-Token`) for sensitive requests, the server can differentiate between normal user requests and forged ones. This approach is effective in preventing CSRF, as browsers typically don’t include custom headers in cross-origin requests.
   
5. **Double Submit Cookies:**
   - In this technique, the server sends a CSRF token in both a cookie and a request parameter (such as a form field). When the request is made, the server verifies that the value of the token in the cookie matches the one in the request parameter.
   
6. **Limit Session Duration:**
   - By limiting the duration of user sessions (i.e., using **short-lived sessions** and forcing reauthentication after a period of inactivity), the opportunity for an attacker to perform a CSRF attack is reduced.

7. **Same Origin Policy:**
   - The **Same-Origin Policy** (SOP) is a browser security measure that restricts how documents or scripts from one origin (domain, protocol, or port) can interact with resources from other origins. This policy reduces the risk of CSRF by preventing an attacker from loading a malicious page on another domain that would execute unwanted requests.

8. **User Confirmation for Sensitive Actions:**
   - For highly sensitive actions (such as transferring money or changing account details), implement additional user confirmation steps, such as requiring re-authentication, CAPTCHA, or multi-factor authentication (MFA).

---

### **Real-World Examples of CSRF Attacks**

1. **GitHub CSRF Vulnerability (2018):**
   - In 2018, a **CSRF vulnerability** was discovered in GitHub’s web application, which could allow an attacker to create repository invitations on behalf of a logged-in user, potentially leading to privilege escalation or unauthorized access. GitHub responded by fixing the vulnerability and applying CSRF protections.

2. **Banking and Financial Services:**
   - In 2015, several banks were reported to be vulnerable to CSRF attacks, which could allow attackers to initiate unauthorized wire transfers from a victim's bank account. The attacks were mitigated by adding CSRF token validation.

---

### **Conclusion**

Request forgery (CSRF) attacks are a serious security threat because they exploit the trust a web application places in the user's browser. These attacks can lead to unauthorized actions, including money transfers, account changes, and data manipulation, all without the victim’s knowledge. By implementing robust defenses such as CSRF tokens, SameSite cookies, referer header checks, and user confirmation for sensitive actions, organizations can significantly reduce the risk of CSRF attacks and enhance the security of their web applications.
