### **Node.js - MongoDB Insert**

In MongoDB, inserting data into a collection is a common task. With the MongoDB Node.js driver, you can insert data in several ways, including inserting a single document or multiple documents. MongoDB provides the `insertOne()` and `insertMany()` methods to insert documents.

Let's go through the steps to insert data into a MongoDB collection using Node.js.

---

### **1. Install MongoDB Node.js Driver**

If you haven’t installed the MongoDB Node.js driver yet, you can install it using npm:

```bash
npm install mongodb
```

---

### **2. Connect to MongoDB**

First, you need to connect to MongoDB and access the database and collection where you want to insert data.

#### **Example: Inserting a Single Document**

Here’s how you can insert a single document into a MongoDB collection using Node.js:

```javascript
const { MongoClient } = require('mongodb');

// MongoDB connection URL
const url = 'mongodb://localhost:27017';  // Update this if you're using MongoDB Atlas
const dbName = 'mydatabase';              // Name of your database

const client = new MongoClient(url);

async function insertOne() {
  try {
    // Connect to MongoDB server
    await client.connect();
    console.log('Connected to MongoDB');

    // Access the database
    const db = client.db(dbName);

    // Access the collection
    const collection = db.collection('users');  // Name of your collection

    // Insert a single document into the collection
    const result = await collection.insertOne({
      name: 'Alice',
      age: 25,
      email: 'alice@example.com'
    });

    console.log(`Document inserted with _id: ${result.insertedId}`);
  } catch (err) {
    console.error('Error:', err);
  } finally {
    // Close the MongoDB connection
    await client.close();
    console.log('Connection closed');
  }
}

insertOne();
```

---

### **3. Explanation of Code**

1. **MongoClient**: The `MongoClient` is used to connect to the MongoDB server.
2. **client.db(dbName)**: This returns a reference to the specified database.
3. **db.collection(collectionName)**: This gives a reference to the specified collection.
4. **collection.insertOne()**: The `insertOne()` method inserts a single document into the collection.
5. **result.insertedId**: After the document is inserted, the `insertedId` contains the ID of the inserted document, which is automatically generated by MongoDB if you do not specify one.

---

### **4. Insert Multiple Documents**

You can insert multiple documents at once using the `insertMany()` method. Here’s how you can do that:

```javascript
const { MongoClient } = require('mongodb');

// MongoDB connection URL
const url = 'mongodb://localhost:27017';  // Update this if you're using MongoDB Atlas
const dbName = 'mydatabase';              // Name of your database

const client = new MongoClient(url);

async function insertMany() {
  try {
    // Connect to MongoDB server
    await client.connect();
    console.log('Connected to MongoDB');

    // Access the database
    const db = client.db(dbName);

    // Access the collection
    const collection = db.collection('users');  // Name of your collection

    // Insert multiple documents into the collection
    const result = await collection.insertMany([
      { name: 'Bob', age: 30, email: 'bob@example.com' },
      { name: 'Charlie', age: 35, email: 'charlie@example.com' },
      { name: 'David', age: 40, email: 'david@example.com' }
    ]);

    console.log(`${result.insertedCount} documents inserted`);
  } catch (err) {
    console.error('Error:', err);
  } finally {
    // Close the MongoDB connection
    await client.close();
    console.log('Connection closed');
  }
}

insertMany();
```

---

### **5. Explanation of Code**

- **insertMany()**: This method inserts multiple documents into the collection. It takes an array of objects, where each object represents a document to insert.
- **result.insertedCount**: This contains the number of documents that were successfully inserted into the collection.

---

### **6. Handling Duplicate Keys**

If your documents have a field that is supposed to be unique (e.g., email), and you try to insert documents with duplicate values for that field, MongoDB will throw an error unless you specify an option to handle duplicates.

To prevent errors when inserting documents with duplicate keys, you can specify the `ordered: false` option, which allows MongoDB to continue inserting the other documents even if some are duplicates:

```javascript
const { MongoClient } = require('mongodb');

// MongoDB connection URL
const url = 'mongodb://localhost:27017';  // Update this if you're using MongoDB Atlas
const dbName = 'mydatabase';              // Name of your database

const client = new MongoClient(url);

async function insertManyWithoutErrors() {
  try {
    // Connect to MongoDB server
    await client.connect();
    console.log('Connected to MongoDB');

    // Access the database
    const db = client.db(dbName);

    // Access the collection
    const collection = db.collection('users');  // Name of your collection

    // Insert multiple documents with the ordered option
    const result = await collection.insertMany(
      [
        { name: 'Alice', age: 25, email: 'alice@example.com' },
        { name: 'Bob', age: 30, email: 'bob@example.com' },
        { name: 'Charlie', age: 35, email: 'alice@example.com' }  // Duplicate email
      ],
      { ordered: false }  // Continue inserting documents even if one fails
    );

    console.log(`${result.insertedCount} documents inserted`);
  } catch (err) {
    console.error('Error:', err);
  } finally {
    // Close the MongoDB connection
    await client.close();
    console.log('Connection closed');
  }
}

insertManyWithoutErrors();
```

The `ordered: false` option ensures that MongoDB will insert the documents that don’t cause errors, even if one of the documents violates unique constraints.

---

### **7. Verify the Insertion**

You can verify the data insertion by:

1. Using MongoDB shell to check the contents of the collection:
   ```bash
   use mydatabase
   db.users.find().pretty()
   ```

2. Using **MongoDB Compass** (GUI for MongoDB) to view the data.

---

### **8. Conclusion**

- **`insertOne()`**: Used to insert a single document into a collection.
- **`insertMany()`**: Used to insert multiple documents at once.
- **Duplicate handling**: You can handle duplicate errors by using the `ordered: false` option.
- **MongoDB will automatically generate an `_id` field** for documents unless you specify one.

By following these steps, you can efficiently insert documents into MongoDB collections using Node.js.
